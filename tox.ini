[tox]
minversion = 2.0
envlist = py27,pep8,unittest,functional
skipsdist = True

[testenv]
# If 'usedevelop' is True, the current will not be installed,
# tox just created a link in virtualenv pointed to current code
usedevelop = True
setenv =
    VIRTUAL_ENV={envdir}
    LANGUAGE=en_US
    LC_ALL=en_US.utf-8
    PYTHONPATH={toxinidir}

deps = -r{toxinidir}/requirements.txt
       -r{toxinidir}/test-requirements.txt
commands =
    find . -type f -name "*.pyc" -delete
whitelist_externals = bash
                      sh
                      find
                      rm
                      env
                      sudo
                      socat
                      qemu-img
                      qemu-system-x86_64
                      ipmi_sim
install_command = pip install -U --force-reinstall {opts} {packages}

passenv = HOME
          TEST_IMAGE_PATH

[testenv:pep8]
basepython = python2.7
setenv = {[testenv]setenv}
commands =
        flake8 test infrasim

[testenv:unittest]
setenv = {[testenv]setenv}
commands =
    {[testenv]commands}
    nosetests -v --with-cov --cov-report term-missing {toxinidir}/test/unit/{posargs}

[testenv:functional]
setenv = {[testenv]setenv}
commands =
    {[testenv]commands}
    nosetests -v --with-cov --cov-report term-missing --cover-inclusive {envdir} {toxinidir}/test/functional/{posargs}

[flake8]
ignore = E121,E122,E123,E124,E125,E126,E127,E128,E129,E131,E251,H405
exclude =  .venv,.git,.tox,dist,doc,*lib/python*,*egg,build,data,template
max-line-length = 120
output-file = pep8-log.txt
jobs = 8
count = True
format = pylint
