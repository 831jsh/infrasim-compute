#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys
import cfgparse
from infrasim import ipmi

VM_DEFAULT_CONFIG = "/etc/infrasim/infrasim.conf"

if __name__ == '__main__':
    config = cfgparse.ConfigParser()
    config.add_file(VM_DEFAULT_CONFIG, type = 'ini')
    config.parse()
    config.add_option('node', keys = 'main')
    opts = config.parse()
    if sys.argv[1] == "start":
        ipmi.ipmi_start(opts.node)
    elif sys.argv[1] == "stop":
        ipmi.ipmi_stop()
    elif sys.argv[1] == "status":
        ipmi.ipmi_status()
    elif sys.argv[1] == "restart":
        ipmi.ipmi_stop()
        print "Restart InfraSIM service..."
        ipmi.ipmi_start(opts.node)
    else:
        ipmi.ipmi_help()
